version: 0.2

env:
  shell: /bin/sh
phases:
  install:
    commands:
      - apt-get update
      - apt install -y default-jre
      - apt install -y unzip
  pre_build:
    commands:
      - DEV_TOOLS=/home/codebuild-user/devtools
      - ANDROID_HOME=$DEV_TOOLS/Android
      - LOCAL_HOME=/home/codebuild-user/.local/bin
      - PATH=$ANDROID_HOME/build-tools/29.0.3:$LOCAL_HOME:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$PATH
      - echo $PATH
      - cd /home/codebuild-user
      - mkdir -p /home/codebuild-user/devtools/Android/cmdline-tools 
      - wget https://dl.google.com/android/repository/commandlinetools-linux-8512546_latest.zip
      - unzip commandlinetools-linux-8512546_latest.zip -d /home/codebuild-user/devtools/Android/cmdline-tools
      - cd /home/codebuild-user/devtools/Android/cmdline-tools
      - mv cmdline-tools latest
      - sdkmanager "platform-tools" "platforms;android-29"
      - sdkmanager "build-tools;29.0.3"
      - yes | sdkmanager --licenses
  build:
    run-as: codebuild-user 
    commands:
      - pip install conan
      - echo $(cd /home/codebuild-user/devtools/Android/cmdline-tools/latest/; ls)
      - mkdir /home/codebuild-user/Projects
      - cd /home/codebuild-user/Projects
      - git clone https://github.com/alexa/alexa-auto-sdk.git
      - cd /home/codebuild-user/Projects/alexa-auto-sdk/aacs/android/sample-app
      - ./gradlew assembleLocalRelease
      
    
